<!DOCTYPE html>
<html>
    <head>
        <title>Cheat</title>
        <meta charset="UTF-8">
        
        <style>
            #nickname-red
            {
                color: red;
            }
            
            #player-cards
            {
                margin-top: 50px;
                color: green;
            }
            
            .move-stl
            {
                color: blue;
            }
            
            #game-panel
            {
                display: none;
            }
            
            #other-players
            {
                color: gray;
                margin-top: 50px;
            }
            
            #stack
            {
                margin-top: 50px;
            }
        </style>
    </head>
    <body>
        <!--You can replace numbers by cards-->
        <div id="nickname"></div>
        <div id="list">
            <div id="listOfPlayers">

            </div>
            <a href="#" id="play">Begin game (all users connected)</a>
        </div>
        <div id="game-panel">
            <div style="margin-top: 25px;">
                <p class="move-stl">Move:</p>
                <p class="move-stl" id="move"></p>
            </div>
            <div id="stack">
                <p style="color: red;">2 heart</p>
            </div>
            <div id="player-cards">
                <p>Your cards (<span id="numberOfC"></span>):</p>
            </div>
            <div id="other-players">
                
            </div>
        </div>
        <script src="/socket.io/socket.io.js"></script>
        <script src="http://code.jquery.com/jquery-3.2.1.min.js"></script>
        <script>
            $(function() {
                var socket = io();
                var nickname = "Player" + Math.floor(Math.random() * 100000).toString();
                $("#nickname").html('Playing as <span id="nickname-red">' + nickname + "</span>");
                var cards = [];
                var numbersOfCards = [];
                var move = 0;
                var users = [];

                socket.emit("join game", nickname);

                socket.on("send player list", function(list) {
                    for (var i = 0; i < list.length; i++) {
                        var name = list[i];
                        
                       $("#listOfPlayers").append("<p>" + name + "</p>");
                    }
                });
                
                socket.on("user connected", function(nickname) {
                    $("#listOfPlayers").append("<p>" + nickname + "</p>");
                });
                
                socket.on("user disconnected", function(nickname) {
                    $("p:contains('" + nickname + "')").remove();
                });
                
                $("#play").click(function() {
                    socket.emit("request begin game");
                });
                
                socket.on("begin game", function(data) {
                    $("#list").fadeOut();
                    $("#game-panel").fadeIn();
                    
                    data["cards"].forEach(function(element) {
                        $("#player-cards").append('<img src="/img/' + element + '.png" alt="' + element + '">');
                    });
                    
                    data["numbersOfCards"].forEach(function(element) {
                        users.push({ "nickname": element.nickname, "numberOfCards": element.number });
                        
                        if (element.nickname !== nickname) {
                        
                            $("#other-players").append("<p>" + element.nickname + ": " + element.number +  "</p>");
                        } else {
                            $("#numberOfC").html(element.number);
                        }
                    });
                    
                    if (data.ownerOf2Heart !== nickname) {
                        $("#move").html(data.ownerOf2Heart);
                    } else {
                        $("#move").html("You");
                    }
                });

                socket.on("end game", function(nickname) {
                    $("body").html('<p>The game has been ended by ' + nickname + '</p><a href="#" onclick="location.reload(true);">Play again</a>');
                });
                
                socket.on("join rejected", function() {
                    $(document).write("You cannot join when game is happening");
                });
            });
        </script>
    </body>
</html>
